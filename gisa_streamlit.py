import streamlit as st
import pandas as pd
import datetime
import time

GITHUB_CSV_URL = f"https://raw.githubusercontent.com/lyh9003/yong/main/Total_Filtered_No_Comment.csv?nocache={int(time.time())}"

def load_data():
    """CSVë¥¼ ë¶ˆëŸ¬ì™€ DataFrameìœ¼ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤."""
    df = pd.read_csv(GITHUB_CSV_URL, encoding='utf-8-sig')
    
    # 1) ë‚ ì§œ ì»¬ëŸ¼ì„ datetime í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    df['date'] = pd.to_datetime(df['date'], errors='coerce')
    
    # 2) ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ê°€ì¥ ìµœê·¼ ê¸°ì‚¬ê°€ ìœ„ë¡œ)
    df = df.sort_values(by='date', ascending=False)
    
    # 3) 'í‚¤ì›Œë“œ' ì»¬ëŸ¼ì„ ì‰¼í‘œ ê¸°ì¤€ìœ¼ë¡œ ë¶„í• í•˜ì—¬ ë¦¬ìŠ¤íŠ¸í™”
    def split_keywords(kw_string):
        if pd.isna(kw_string):
            return []
        return [k.strip() for k in kw_string.split(',') if k.strip()]
    
    df['í‚¤ì›Œë“œ_ëª©ë¡'] = df['í‚¤ì›Œë“œ'].apply(split_keywords)
    
    # 4) explodeë¥¼ ì´ìš©í•˜ì—¬ í‚¤ì›Œë“œë³„ë¡œ ë ˆì½”ë“œë¥¼ í¼ì¹¨
    df = df.explode('í‚¤ì›Œë“œ_ëª©ë¡', ignore_index=True)
    
    # 5) 'ê´€ë ¨ ì—†ìŒ'ì„ 'ê¸°íƒ€'ë¡œ ë³€ê²½
    df['í‚¤ì›Œë“œ_ëª©ë¡'] = df['í‚¤ì›Œë“œ_ëª©ë¡'].replace('ê´€ë ¨ ì—†ìŒ', 'ê¸°íƒ€')
    
    return df

# ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
df = load_data()

st.title("ğŸ“¢ë°˜ë„ì²´ ë‰´ìŠ¤ë ˆí„°(Rev.25.3.13)")
st.write("ì£¼ì†Œ ì´ì „ : https://semi-news.streamlit.app/")
